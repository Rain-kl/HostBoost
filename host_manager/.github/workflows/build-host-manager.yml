name: Host Manager Manual Build

on:
    workflow_dispatch:

jobs:
    build:
        runs-on: ubuntu-latest
        defaults:
            run:
                working-directory: host_manager
        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Generate Build Version
              id: version
              run: |
                  VERSION=$(date -u +"%Y.%m.%d.%H%M%S")
                  echo "build_version=${VERSION}" >> $GITHUB_OUTPUT
                  echo "BUILD_VERSION=${VERSION}" >> $GITHUB_ENV

            - name: Setup Go
              uses: actions/setup-go@v5
              with:
                  go-version-file: host_manager/go.mod
                  cache: true

            - name: Download dependencies
              run: go mod download

            - name: Build
              run: go build ./...

            - name: Execute service in version mode
              run: go run . --version

            - name: Summary
              run: |
                  echo "## Host Manager build" >> $GITHUB_STEP_SUMMARY
                  echo "" >> $GITHUB_STEP_SUMMARY
                  echo "- Build version: $BUILD_VERSION" >> $GITHUB_STEP_SUMMARY
                  echo "- go version file: host_manager/go.mod" >> $GITHUB_STEP_SUMMARY
